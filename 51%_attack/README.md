블록체인 기술의 핵심적인 가치는 탈 중앙화 시스템이다. 

이는 기존의 서버-클라이언트 관계가 아닌 노드(node)들의 자발적이고 자율적인 연결에 의해 P2P 방식으로 작동한다.

즉 누구나 참여가 가능하며 의사결정 또한 과반수 이상의 합의가 필요하다. 

하지만 어느 집단이나 개인이 시스템 안에서 과반수 이상의 힘을 가지게 된다면 어떻게 될까?

비트코인에서는 이를 ‘51% 공격’이라 한다. 

본 실험에서는 51% 공격을 구현하여 정상적인 사용자들의 거래를 공격했을 때 변화를 확인한다.

51% 공격(>50% 공격, 과반수 공격)

<img width="1049" alt="스크린샷 2020-07-23 오후 6 30 41" src="https://user-images.githubusercontent.com/33947681/88271766-9e782200-cd12-11ea-8a88-e35e1f55d150.png">

(그림 1) 비트코인 블록 생성 과정

(그림 1)은 비트코인의 블록 생성 과정을 순서대로 보여준다.

①: 사용자들간의 거래가 발생하면 거래 내역은 P2P네트워크를 통해 전체 사용자에게 전달된다. 사용자는 전달 받은 거래 내역을 비트코인 코어에 저장한다.

②: 채굴 프로그램은 블록 생성에 필요한 정보 (이전 블록 해시값, 버전, 현재 시간, 거래 내역 리스트, 난이도 값)를 비트코인 코어에 요청한다.

③: 비트코인 코어는 채굴 프로그램에 요청 받은 정보를 전달한다. 

④: 받은 정보와 임의의 값을 더하고 해시 함수를 이용해 해시값을 구한다.

⑤: 난이도 값과 해시값을 비교하여 해시값이 난이도 값보다 크다면 과정 ②부터 다시 실행한다. 해시값이 난이도 값보다 작을 경우 블록을 생성한다.

⑥: 생성한 블록은 비트코인 코어에 전달한다.

⑦: 비트코인 코어에서 전달 받은 새로운 블록을 P2P 네트워크를 통해 다른 사용자들에게 전달한다. 사용자들은 전달 받은 블록을 자신의 블록에 추가하게 된다.


본 논문에서 악의적인 사용자는 (그림 1)의 비트코인 블록 생성 과정 중 ②의 과정을 조작한다. 

이를 통해 악의적인 사용자는 거래 내역을 포함하지 않는 블록을 만들어 정상적인 사용자들에게 정상적인 블록이라 판단하게 하고 동기화 하는 것을 목표로 한다.

이는 비트코인 에서 가장 긴 블록을 정상적인 블록이라 판단하기 때문이다.




 
 <img width="654" alt="스크린샷 2020-07-23 오후 6 33 17" src="https://user-images.githubusercontent.com/33947681/88271986-fb73d800-cd12-11ea-9303-f341b0e74f61.png">
 
(그림 2) 블록 구조도

악의적인 사용자는 (그림 2)의 블록 A가 생성된 후 진행된 거래를 조작하기로 한다.

그래서 블록A가 생성된 후 악의적인 사용자는 정상적인 사용자들과 연결을 끊는다. 

정상적인 사용자들과 연결을 끊었기에 정상적인 사용자들이 ‘A-C-D’ 순서로 블록을 만들어 전파할 때 악의적인 사용자는 동기화를 하지 않는다. 

악의적인 사용자는 조작된 블록을 만들어 정상적인 사용자들보다 블록의 길이가 길어지면 정상적인 사용자들과 연결을 한다.

정상적인 사용자들은 악의적인 사용자의 블록이 더 길기에 정상적인 블록이라 판단하고 동기화를 진행한다.


공격의 진행 순서는 다음과 같다.

ㄱ.	정상적인 사용자들은 [사용자A가 사용자B 에게 1000코인을 준다] 라는 거래를 진행하고 해당 거래가 포함된 블록을 만든다.

ㄴ.	악의적인 사용자는 정상적인 사용자들이 블록을 만들고 있을 때 연결을 끊고 거래 내역을 포함하지 않는 블록을 만든다.

ㄷ.	악의적인 사용자의 블록이 정상적인 사용자들의 블록보다 많아지게 되면 정상적인 사용자들과 연결한다.



4.2. 실험 결과

블록 생성은 [cpuminer](https://github.com/pooler/cpuminer)를 사용하였다.

해시 파워를 측정했을때 악의적인 사용자는 4개의 스레드의 합이 평균 40928khash/s가 나왔다.

정상적인 사용자의 해시파워는 4개의 스레드 합이 평균 10145.5khash/s가 나와 똑같은 컴퓨터 4대를 사용해 정상적인 사용자들은 40580khash/s의 해시파워를 가지고 있다고 가정하였다.

해시파워를 구하는 과정은 정상적인 블록 100개를 생성하는동안 측정된 해시파워의 평균값을 기준으로 하였다.

이로서 악의적인 사용자는 50.2%의 해시파워를 정상적인 사용자들은 49.8%의 해시파워를 보유하였다고 가정하였다. 

정상적인 사용자와 악의적인 사용자는 1146번 블록부터 연결을 끊었다.

[사용자A가 사용자B에게 1000 코인을 준다] 라는 거래는 1147번 블록에 들어가 생성 되었다.

(그림 3)은 해당 거래가 기록된 트랜잭션이다.

여기서 ‘Transaction ID’는 해당 트랜잭션이 다른 트랜잭션과 구별될 수 있도록 부여된 아이디를 말한다.

 <img width="444" alt="스크린샷 2020-07-07 오후 8 46 23" src="https://user-images.githubusercontent.com/33947681/88273921-e0ef2e00-cd15-11ea-805b-b2b45a923e1c.png">
 
(그림 3) 거래 트랜잭션


(그림 4)는 생성된 블록 번호와 저장된 트랜잭션을 빨간색 테두리로 표시하였다. 

(그림 5)은 블록이 생성된 후 사용가능 금액에 1000 코인이 표시된 사진이다.
 
 <img width="530" alt="스크린샷 2020-07-17 오후 3 04 51" src="https://user-images.githubusercontent.com/33947681/88273717-9077d080-cd15-11ea-823f-c5fa42b35270.png">
 
(그림4) 정상적인 사용자들이 만든 1147번 블록


 <img width="525" alt="스크린샷 2020-07-17 오후 3 03 56" src="https://user-images.githubusercontent.com/33947681/88273890-d92f8980-cd15-11ea-91da-ae2d12d6f34d.png">
 
(그림 5) 정상적인 사용자의 잔액

악의적인 사용자는 정상적인 사용자들보다 블록을 많이 만든 뒤 정상적인 사용자들과 연결하였다. 

그러자 정상적인 사용자들의 블록이 악의적인 사용자의 블록으로 대체 되었고 거래 내역이 블록에서 사라지게 되었다. 

(그림 6)에서 1147번 블록으로 대체되어 기존의 거래가 사라진 모습을 확인할 수 있다. 

(그림 7)는 기존의 사용가능에 있던 1000코인이 보류된 금액으로 전환된 것을 확인할 수 있다.

 <img width="526" alt="스크린샷 2020-07-17 오후 2 57 44" src="https://user-images.githubusercontent.com/33947681/88273725-92da2a80-cd15-11ea-9c20-56f1985bd66d.png">
 
(그림 6) 악의적인 사용자의 1147번 블록으로 변경

 <img width="525" alt="스크린샷 2020-07-17 오후 3 02 23" src="https://user-images.githubusercontent.com/33947681/88273900-db91e380-cd15-11ea-9602-cd2d59a90745.png">
 
 
(그림 7) 변경된 잔액
